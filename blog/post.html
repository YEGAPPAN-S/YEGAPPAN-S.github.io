<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Dynamic meta filled by JS -->
  <title>Loading... — Yegappan Sekar</title>
  <meta name="description" content="">
  <meta name="robots" content="index, follow">

  <!-- OG tags - filled by JS -->
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Yegappan Sekar">
  <meta property="og:image" content="https://YEGAPPAN-S.github.io/images/og-home.png">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">

  <!-- JSON-LD filled by JS -->
  <script id="json-ld" type="application/ld+json">{}</script>

  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="icon" href="/images/favicon.ico">
</head>
<body>

<div class="reading-progress" aria-hidden="true"></div>

<nav class="nav">
  <div class="nav__inner">
    <a href="/" class="nav__logo">Yega<span>.</span></a>
    <ul class="nav__links">
      <li><a href="/">Home</a></li><li><a href="/about.html">About</a></li>
      <li><a href="/projects.html">Projects</a></li>
      <li><a href="/blog/" class="active">Blog</a></li>
      <li><a href="/contact.html">Contact</a></li>
    </ul>
    <div class="nav__actions">
      <button class="theme-toggle" aria-label="Toggle theme">
        <svg class="icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
        <svg class="icon-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
      <button class="nav__hamburger" aria-label="Menu"><span></span><span></span><span></span></button>
    </div>
  </div>
</nav>

<!-- Post content area -->
<main>
  <!-- Loading state -->
  <div id="post-loading" class="container--narrow" style="padding:4rem 1.5rem; text-align:center;">
    <div class="spinner" style="width:32px; height:32px; margin:0 auto;"></div>
    <p style="color:var(--text-3); font-family:var(--font-ui); margin-top:1rem;">Loading article...</p>
  </div>

  <!-- Error state -->
  <div id="post-error" class="container--narrow" style="display:none; padding:4rem 1.5rem; text-align:center;">
    <h2 style="margin-bottom:1rem;">Post not found</h2>
    <p style="color:var(--text-3); margin-bottom:2rem;">This post may have been moved or deleted.</p>
    <a href="/blog/" class="btn btn--primary">← Back to Blog</a>
  </div>

  <!-- Actual post -->
  <div id="post-content" style="display:none;">
    <!-- Hero -->
    <div class="post-hero" style="border-bottom:1px solid var(--border);">
      <div class="container--narrow">
        <a href="/blog/" id="post-back" class="btn btn--ghost btn--sm" style="margin-bottom:1.5rem; display:inline-flex; gap:0.5rem;">
          ← All posts
        </a>
        <a id="post-category-link" href="/blog/" class="post-hero__category"></a>
        <h1 class="post-hero__title" id="post-title"></h1>
        <div class="post-hero__meta">
          <span id="post-date"></span>
          <span>·</span>
          <span id="post-reading-time"></span>
        </div>
        <div class="tags" id="post-tags"></div>
        <div class="post-hero__cover" id="post-cover" style="display:none;">
          <img id="post-cover-img" src="" alt="">
        </div>
      </div>
    </div>

    <!-- Layout: content + sidebar TOC -->
    <div class="container" style="padding-top:3rem; padding-bottom:3rem;">
      <div class="post-layout" id="post-layout">
        <!-- Main content -->
        <article>
          <div class="prose" id="post-body"></div>

          <!-- Share -->
          <div class="post-share">
            <span style="font-family:var(--font-ui); font-size:0.875rem; color:var(--text-3); margin-right:0.5rem;">Share:</span>
            <a id="share-twitter" href="#" target="_blank" rel="noopener" class="btn btn--outline btn--sm">Twitter</a>
            <a id="share-linkedin" href="#" target="_blank" rel="noopener" class="btn btn--outline btn--sm">LinkedIn</a>
            <button id="share-copy" class="btn btn--outline btn--sm" onclick="copyPostUrl()">Copy link</button>
          </div>

          <!-- Post navigation -->
          <div class="post-nav" id="post-nav"></div>
        </article>

        <!-- TOC Sidebar -->
        <aside class="post-toc-sidebar">
          <div class="post-toc">
            <div class="post-toc__title">On this page</div>
            <ol class="post-toc__list" id="toc-list"></ol>
          </div>
        </aside>
      </div>
    </div>
  </div>
</main>

<footer class="footer">
  <div class="footer__inner">
    <div class="footer__brand">
      <a href="/" class="footer__logo">Yega<span style="color:var(--accent)">.</span></a>
      <p class="footer__tagline">Senior Software Engineer · Coimbatore</p>
    </div>
    <div>
      <div class="footer__col-title">Navigation</div>
      <ul class="footer__links">
        <li><a href="/">Home</a></li><li><a href="/about.html">About</a></li>
        <li><a href="/projects.html">Projects</a></li><li><a href="/blog/">Blog</a></li>
      </ul>
    </div>
    <div>
      <div class="footer__col-title">Feed</div>
      <ul class="footer__links">
        <li><a href="/rss.xml">RSS Feed</a></li>
        <li><a href="/privacy.html">Privacy Policy</a></li>
      </ul>
    </div>
  </div>
  <div class="footer__bottom">
    <span>© <script>document.write(new Date().getFullYear())</script> Yegappan Sekar.</span>
  </div>
</footer>

<button class="back-to-top" aria-label="Back to top">
  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18,15 12,9 6,15"/></svg>
</button>

<script src="/assets/js/app.js"></script>
<script src="/assets/js/api.js"></script>
<script>
function copyPostUrl() {
  navigator.clipboard.writeText(window.location.href).then(() => {
    showToast('Link copied!');
  }).catch(() => showToast('Copy failed', 'error'));
}

async function loadPost() {
  const slug = new URLSearchParams(window.location.search).get('slug');
  if (!slug) return showError();

  try {
    const res = await API.getPost(slug);
    const post = res.data;
    renderPost(post);
  } catch (err) {
    if (err.code === 404) showError();
    else showError('Failed to load. Please try again.');
  }
}

function showError(msg) {
  document.getElementById('post-loading').style.display = 'none';
  const el = document.getElementById('post-error');
  el.style.display = 'block';
  if (msg) el.querySelector('p').textContent = msg;
}

function renderPost(post) {
  document.getElementById('post-loading').style.display = 'none';
  document.getElementById('post-content').style.display = 'block';

  // Set meta
  const title = post.meta_title || post.title;
  const desc = post.meta_description || post.excerpt;
  const url = `${window.SITE_CONFIG.siteUrl}/blog/post.html?slug=${post.slug}`;
  const canonical = post.canonical_url || url;

  document.title = `${title} — Yegappan Sekar`;
  document.querySelector('meta[name="description"]').content = desc;

  // OG
  document.querySelector('meta[property="og:title"]')?.setAttribute('content', title);
  document.querySelector('meta[property="og:description"]')?.setAttribute('content', desc);
  document.querySelector('meta[property="og:url"]')?.setAttribute('content', url);

  // Canonical
  let canonEl = document.querySelector('link[rel="canonical"]');
  if (!canonEl) { canonEl = document.createElement('link'); canonEl.rel = 'canonical'; document.head.appendChild(canonEl); }
  canonEl.href = canonical;

  // JSON-LD
  const ld = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": post.title,
    "description": post.excerpt,
    "datePublished": post.published_at,
    "url": url,
    "author": {
      "@type": "Person",
      "name": "Yegappan Sekar",
      "url": window.SITE_CONFIG.siteUrl
    },
    "publisher": {
      "@type": "Person",
      "name": "Yegappan Sekar"
    }
  };
  if (post.cover_image) ld.image = post.cover_image;
  document.getElementById('json-ld').textContent = JSON.stringify(ld);

  // Render content
  document.getElementById('post-category-link').textContent = post.category || 'Engineering';
  document.getElementById('post-category-link').href = `/blog/?category=${encodeURIComponent(post.category || '')}`;
  document.getElementById('post-title').textContent = post.title;
  document.getElementById('post-date').textContent = formatDate(post.published_at);
  document.getElementById('post-reading-time').textContent = `${post.reading_time || 1} min read`;

  // Tags
  const tagsEl = document.getElementById('post-tags');
  tagsEl.innerHTML = (post.tags || '').split(',').filter(t=>t.trim()).map(t =>
    `<a href="/blog/?tag=${encodeURIComponent(t.trim())}" class="tag">${t.trim()}</a>`
  ).join('');

  // Cover image
  if (post.cover_image) {
    document.getElementById('post-cover').style.display = 'block';
    const img = document.getElementById('post-cover-img');
    img.src = post.cover_image;
    img.alt = post.title;
  }

  // Markdown → HTML
  const bodyEl = document.getElementById('post-body');
  bodyEl.innerHTML = MarkdownParser.parse(post.content_md || '');

  // Generate TOC
  const tocList = document.getElementById('toc-list');
  TableOfContents.generate(bodyEl, tocList);

  // Share links
  const tweetText = encodeURIComponent(`${post.title} by @yegappan_s`);
  document.getElementById('share-twitter').href = `https://twitter.com/intent/tweet?text=${tweetText}&url=${encodeURIComponent(url)}`;
  document.getElementById('share-linkedin').href = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;

  // Load adjacent posts for nav
  loadAdjacentPosts(post);
}

async function loadAdjacentPosts(currentPost) {
  try {
    const res = await API.getPosts({ limit: 50 });
    const posts = res.data || [];
    const idx = posts.findIndex(p => p.slug === currentPost.slug);
    const prev = posts[idx + 1];
    const next = posts[idx - 1];

    const navEl = document.getElementById('post-nav');
    navEl.innerHTML = `
      ${prev ? `<a href="/blog/post.html?slug=${encodeURIComponent(prev.slug)}" class="post-nav__item">
        <div class="post-nav__label">← Previous</div>
        <div class="post-nav__title">${prev.title}</div>
      </a>` : '<div></div>'}
      ${next ? `<a href="/blog/post.html?slug=${encodeURIComponent(next.slug)}" class="post-nav__item post-nav__item--next">
        <div class="post-nav__label">Next →</div>
        <div class="post-nav__title">${next.title}</div>
      </a>` : '<div></div>'}
    `;
  } catch (e) {}
}

loadPost();
</script>
</body>
</html>
