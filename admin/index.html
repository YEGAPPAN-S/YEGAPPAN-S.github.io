<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard — Admin</title>
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/admin.css">
  <link rel="icon" href="/images/favicon.ico">
</head>
<body class="admin-body">

<div class="admin-layout">
  <!-- Sidebar -->
  <aside class="admin-sidebar" id="admin-sidebar">
    <a href="/admin/" class="admin-sidebar__logo">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      Yega<span>.</span> Admin
    </a>
    <nav class="admin-nav">
      <div class="admin-nav__section">Content</div>
      <a href="/admin/" class="admin-nav__item active">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        Dashboard
      </a>
      <a href="/admin/posts.html" class="admin-nav__item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Posts
      </a>
      <a href="/admin/editor.html" class="admin-nav__item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New Post
      </a>
      <div class="admin-nav__section">Site</div>
      <a href="/admin/settings.html" class="admin-nav__item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </a>
      <a href="/" target="_blank" class="admin-nav__item">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15,3 21,3 21,9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        View Site
      </a>
    </nav>
    <div class="admin-sidebar__footer">
      <button id="logout-btn" class="btn btn--ghost btn--sm" style="width:100%; color:var(--text-3);">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Logout
      </button>
    </div>
  </aside>

  <!-- Main -->
  <div class="admin-main">
    <div class="admin-topbar">
      <div style="display:flex; align-items:center; gap:1rem;">
        <button id="sidebar-toggle" class="btn btn--ghost btn--sm" style="display:none; padding:0.4rem;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
        </button>
        <span class="admin-topbar__title">Dashboard</span>
      </div>
      <div class="admin-topbar__actions">
        <button class="theme-toggle" aria-label="Toggle theme">
          <svg class="icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
          <svg class="icon-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
        <a href="/admin/editor.html" class="btn btn--primary btn--sm">+ New Post</a>
      </div>
    </div>

    <div class="admin-content">
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card"><div class="stat-card__label">Total Posts</div><div class="stat-card__value" id="stat-total">—</div></div>
        <div class="stat-card"><div class="stat-card__label">Published</div><div class="stat-card__value" id="stat-published">—</div></div>
        <div class="stat-card"><div class="stat-card__label">Drafts</div><div class="stat-card__value" id="stat-drafts">—</div></div>
        <div class="stat-card"><div class="stat-card__label">Messages</div><div class="stat-card__value" id="stat-messages">—</div><div class="stat-card__sub" id="stat-new-messages"></div></div>
      </div>

      <div style="display:flex; align-items:baseline; justify-content:space-between; margin-bottom:1rem; flex-wrap:wrap; gap:1rem;">
        <h2 style="font-family:var(--font-display); font-size:1.25rem; font-weight:500; letter-spacing:-0.02em;">Recent Posts</h2>
        <a href="/admin/posts.html" class="btn btn--ghost btn--sm">View all →</a>
      </div>

      <div class="admin-table-wrap">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Category</th>
              <th>Status</th>
              <th>Published</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="recent-posts-tbody">
            <tr><td colspan="5" style="text-align:center; padding:2rem; color:var(--text-3); font-family:var(--font-ui); font-size:0.875rem;">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="/assets/js/app.js"></script>
<script src="/assets/js/api.js"></script>
<script>
if (!API.Admin.requireAuth()) {}

// Logout
document.getElementById('logout-btn').addEventListener('click', async () => {
  await API.Admin.logout();
  window.location.href = '/admin/login.html';
});

// Mobile sidebar toggle
const sidebarToggle = document.getElementById('sidebar-toggle');
sidebarToggle.style.display = 'flex';
sidebarToggle.addEventListener('click', () => {
  document.getElementById('admin-sidebar').classList.toggle('open');
});

async function loadStats() {
  try {
    const res = await API.Admin.getStats();
    const stats = res.data;
    document.getElementById('stat-total').textContent = stats.totalPosts;
    document.getElementById('stat-published').textContent = stats.publishedPosts;
    document.getElementById('stat-drafts').textContent = stats.draftPosts;
    document.getElementById('stat-messages').textContent = stats.totalMessages;
    if (stats.newMessages > 0) {
      document.getElementById('stat-new-messages').textContent = stats.newMessages + ' new';
      document.getElementById('stat-new-messages').style.color = 'var(--accent)';
    }
  } catch(e) {}
}

async function loadRecentPosts() {
  const tbody = document.getElementById('recent-posts-tbody');
  try {
    const res = await API.Admin.getPosts();
    const posts = (res.data || []).slice(0, 10);
    if (!posts.length) {
      tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:2rem; color:var(--text-3); font-family:var(--font-ui);">No posts yet. <a href="/admin/editor.html">Create your first post →</a></td></tr>';
      return;
    }
    tbody.innerHTML = posts.map(p => `
      <tr>
        <td><div class="admin-table__title" title="${p.title}">${p.title}</div></td>
        <td><span style="font-family:var(--font-mono); font-size:0.75rem; color:var(--text-3);">${p.category || '—'}</span></td>
        <td><span class="badge badge--${p.status === 'published' ? 'published' : 'draft'}">${p.status}</span></td>
        <td><span style="font-family:var(--font-ui); font-size:0.8125rem; color:var(--text-3);">${p.published_at ? formatDate(p.published_at) : '—'}</span></td>
        <td>
          <div class="admin-table__actions">
            <a href="/admin/editor.html?id=${encodeURIComponent(p.id)}" class="btn btn--ghost btn--sm">Edit</a>
            <a href="/blog/post.html?slug=${encodeURIComponent(p.slug)}" target="_blank" class="btn btn--ghost btn--sm">View</a>
          </div>
        </td>
      </tr>
    `).join('');
  } catch(e) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:2rem; color:var(--red); font-family:var(--font-ui);">Failed to load posts.</td></tr>';
  }
}

loadStats();
loadRecentPosts();
</script>
</body>
</html>
